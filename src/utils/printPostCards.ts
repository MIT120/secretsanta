import { GeneratedPairs } from './generatePairs';
import { Participant } from '../types';

export function generatePrintablePostCards(
    assignments: GeneratedPairs,
    participants: Record<string, Participant>,
    instructions?: string
): string {
    const adjustedPairings = assignments.pairings.map(({ giver, receiver }): [string, string, string | undefined] => [
        participants[giver.id]?.name ?? giver.name,
        participants[receiver.id]?.name ?? receiver.name,
        participants[receiver.id]?.hint,
    ]);

    adjustedPairings.sort((a, b) => a[0].localeCompare(b[0]));

    const postCardsHTML = adjustedPairings.map(([giver, receiver, hint]) => {
        const instructionsHTML = (instructions || hint)
            ? `
        <div class="mt-6 flex p-4 bg-gray-50 rounded-lg leading-6 text-gray-600 whitespace-pre-wrap">
          <div class="mr-4">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" fill="currentColor"/>
            </svg>
          </div>
          <div class="space-y-2">
            ${hint ? `<p>${escapeHtml(hint)}</p>` : ''}
            ${instructions ? `<p>${escapeHtml(instructions)}</p>` : ''}
          </div>
        </div>
      `
            : '';

        // SVG content for decorations - using the complete SVG from files
        const christmasWreathSVG = `<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 432 432" xml:space="preserve"><g><path fill="#1F2621" d="M386.8,164.7c-1.1-1-2.2-1.9-3.2-2.9c-6.5-5.8-13.2-11.7-17.6-19.7c0-0.1-0.1-0.1-0.1-0.2c-2.9-6.3-4.8-13-6.5-19.4c-1.8-6.5-3.5-12.7-6.2-18.6c-0.8-1.6-1.8-3-3-4.3c-2.1-2.3-4.8-4.2-8.4-6c-2.9-1.5-6.1-2.8-9.2-4c-2.8-1.1-5.7-2.3-8.4-3.6c-10.4-3.9-17.6-11.7-24.5-19.3c-4.1-4.5-8-8.7-12.5-12.2c-7-1.6-14.3-1.1-21.9-0.7c-3.7,0.2-7.5,0.5-11.4,0.4c-9.9,1.2-19.5-1.8-28.9-4.6c-13-4-25.4-7.8-37.2,0.1c-9.7,6.5-20.4,11.7-32,15.4c-13.4-3.9-28.2-3.7-41.5-0.4c-1.8,3.2-1.4,7-1.7,10.6c-0.2,3-0.3,6-0.5,9c-7.7,7.2-15.7,14.4-24.5,20.6l-1.8,1.3c-2.9,3.7-5.2,7.9-7,12.8c-0.7,1.9-1.4,3.9-1.9,6.1c0,0.1-0.1,0.2-0.1,0.3c-3.6,9.5-9.5,18.8-18.1,28.5l-0.1,0.1c-6.4,6.7-7,15.4-6.7,23.8v0.2l-1.3,43.2c0,0.1,0,0.2,0,0.4l-4.3,29.8c0,0,0,0,0,0.1c-0.2,1.5-0.4,2.9-0.6,4.2c-0.5,4.4-0.7,8.3-0.4,11.9c1,0.9,2.1,1.9,3.2,2.8c6.5,5.8,13.2,11.7,17.7,19.8c0,0.1,0.1,0.1,0.1,0.2c2.9,6.3,4.8,13,6.5,19.4c1.8,6.5,3.5,12.7,6.2,18.5c0.8,1.6,1.8,3,3,4.3c2.1,2.2,4.8,4.2,8.4,6c2.9,1.5,6.1,2.7,9.2,4c2.8,1.1,5.7,2.3,8.5,3.6c10.4,3.9,17.6,11.7,24.5,19.3c4.1,4.5,8,8.7,12.5,12.2c7,1.6,14.3,1.1,21.9,0.7c3.7-0.2,7.6-0.4,11.4-0.4c1.6-0.2,3.1-0.3,4.6-0.3c8.3,0,16.4,2.5,24.2,4.9c13.1,4,25.4,7.8,37.2-0.1c17.5-11.8,38.4-19.1,62.1-21.8c2.6-2.4,5.2-4.9,7.7-7.3c9.5-9,19.3-18.4,30.3-26.1l0.5-0.4c0.4-0.3,0.9-0.6,1.3-0.9c2.9-3.7,5.2-7.9,7-12.8c0.7-1.9,1.3-3.9,1.9-6c0-0.1,0.1-0.2,0.1-0.3c3.6-9.5,9.5-18.9,18.1-28.6c0,0,0-0.1,0.1-0.1c6.4-6.7,7-15.4,6.7-23.8c-0.1-2.5-0.3-5-0.5-7.4c-0.4-4.8-0.7-9.7-0.4-14.4c-0.4-7.9,0.9-15.4,2.2-21.8c0-7.3,1.4-14.6,2.8-21.6c0.8-4.1,1.7-8.4,2.2-12.6C387,172.1,387.1,168.3,386.8,164.7z M299.7,140.5c1,0.3,2,0.7,2.9,1c3.2,16.3,8.5,33.4,22.4,43.9c-0.3,2.1-0.7,4.1-1.1,6.1c-1.3,6.4-2.8,12.8-3.5,19.3c-0.1,1.4,0,2.7,0.2,4.1c-0.9,8.2-1.1,16.4-0.7,24.6c0.1,3,0.4,6.1,0.6,9.1c-6,8.2-12.6,16.3-16.7,25.6c-1.4,3.1-2.6,6.4-3.3,9.9c0,0.2-0.1,0.4-0.1,0.6c-0.5,0.4-1.1,0.7-1.7,1.1c-9.4,6.1-17.9,13.4-24.8,22.2c-18.4-0.9-33.3,10.1-49,17.6c-7.8-1.4-14.9-5.4-22.7-6.7c-10.2-1-20.4,0.4-30.5,1.1c-10-13.5-23.8-22.9-39.5-28.4c-1-0.3-2-0.7-2.9-1c-3.2-16.3-8.5-33.4-22.4-43.9c0.3-2.1,0.7-4.1,1.1-6.1c1.3-6.4,2.8-12.8,3.5-19.3c0.1-1.4,0-2.7-0.2-4.1c0.9-8.2,1.1-16.4,0.7-24.6c-0.1-3-0.4-6.1-0.6-9.1c6-8.2,12.6-16.3,16.7-25.6c1.4-3.2,2.6-6.4,3.3-9.9c0-0.2,0.1-0.4,0.1-0.6c0.6-0.3,1.1-0.7,1.7-1.1c2.7-1.7,5.3-3.6,7.8-5.5c11.4-0.8,22.7-3.8,33.3-7.8c-10.3,12.2-20.6,25.6-35.5,32.5c-4,2-8.5,2.7-12.4,4.9c-0.6,2.7,0.3,5.7,3.3,6.4c7.5,3,16.2,5.4,21.5,11.7c-1.6,11.1-5.7,21.7-9,32.3c-1.4,3.3-1,6.8-0.3,10.3c5.8-0.4,11.5-1.5,16.7-4.2c23.6-11.9,39.7-35.3,46.9-60.3l0.8-0.1c2.9,11.6,8.6,22.4,16.2,31.5c13.4,15.2,32.7,23.3,52.1,27.2c1-0.6,3.1-1.9,4.2-2.5c-0.2-2.1,0.4-4.4-0.6-6.3c-5.3-10.5-10.3-21.2-13.5-32.5c5.9-5.7,13-10.1,19.4-15.1c3.4-2.4,1-8.7-3.3-8.2c-19.1-0.7-36.2-12.9-46.7-28.3c15.6,0.3,31.5,3.6,46.8-0.8C286.9,135.2,293.1,138.2,299.7,140.5z"/><path fill="#85A38D" d="M173,73.6c4.6-2.2,9.2-4.7,13.9-7.2c4.9-2.6,10-5.3,15-7.7c0.6-0.3,1.3-0.4,1.9-0.3c5.8,1,11.2,3,16.5,4.8c5.2,1.9,10.2,3.7,15.4,4.5c0.2,0,0.4,0,0.7,0.1c-4.4,2.9-8.4,6.3-11.9,10.3c-6.5-5-14.3-9.4-22.8-8.3c-8.2,0-15.7,4.6-20.5,11C178.7,78.1,176,75.7,173,73.6z M295.7,83.5c11.1,9.9,24.5,17.7,39.5,22.9c1.5,0.5,2.8,1,4,1.3c1.1,0.3,2,1.3,2.2,2.4c4.2,21.5,11.1,45.5,30.3,60c0.9,0.7,1.4,1.9,1.2,3c-0.5,3.2-1,6.2-1.5,8.7c-0.5,2.3-0.9,4.6-1.4,6.8c-1.4,6.5-2.8,13.3-3.5,20c-0.1,1.6,0,3.3,0.2,5.1c0,0.2,0,0.5,0,0.7c-1.2,10.8-1.5,22.3-1,34.2c0.2,4.1,0.5,8.4,0.9,12.7c0.1,0.8-0.1,1.5-0.6,2.2c-1.4,2-2.9,3.9-4.4,5.9c-7,9.4-14.2,19.1-18.9,29.6c0,0,0,0,0,0c-2,4.5-3.5,8.9-4.4,13.3c0,0,0,0,0,0.1c-0.1,0.2-0.1,0.5-0.2,0.7c-0.2,0.8-0.7,1.6-1.4,2.1c-0.8,0.5-1.5,1-2.3,1.5c-13.9,9-25.4,19.3-34.2,30.6c-0.6,0.8-1.6,1.3-2.7,1.2c-19.2-0.9-35.4,7.7-52.5,16.8c-4.9,2.6-10,5.3-15,7.7c-0.4,0.2-0.9,0.3-1.4,0.3c-0.2,0-0.4,0-0.5,0c-5.8-1-11.2-3-16.5-4.8c-5.2-1.9-10.2-3.7-15.4-4.5c-10.8-1-22-0.1-32.8,0.8c-3.2,0.3-6.5,0.5-9.7,0.8c-1.1,0.1-2.1-0.4-2.8-1.3c-13.1-17.7-31.8-31.2-54.2-38.9c-1.4-0.5-2.7-0.9-4-1.3c-1.1-0.3-2-1.3-2.2-2.4c-4.2-21.6-11.2-45.5-30.3-60c-0.9-0.7-1.4-1.9-1.2-3c0.5-3.2,1.1-6.3,1.5-8.7c0.5-2.3,0.9-4.6,1.4-6.9c1.4-6.5,2.8-13.3,3.5-20c0.1-1.6,0-3.3-0.2-5.1c0-0.2,0-0.5,0-0.7c1.2-10.8,1.5-22.3,1-34.2c-0.2-4.1-0.5-8.4-0.9-12.7c-0.1-0.8,0.1-1.5,0.6-2.2c1.4-2,2.9-3.9,4.4-5.9c7-9.4,14.1-19,18.9-29.6c2.1-4.5,3.5-8.9,4.5-13.4c0,0,0-0.1,0-0.1c0.1-0.2,0.1-0.5,0.1-0.7c0.2-0.9,0.7-1.6,1.4-2.1c0.9-0.6,1.6-1,2.2-1.4c5.2-3.4,10-6.9,14.5-10.6c0.7,11.9,2.9,23.7,7.7,34.8c0.1,0,0.2,0,0.3,0.1c-1.4,2.3-2.6,4.7-3.5,7.1c-0.6,1.5-1,3-1.4,4.5c-2.7,7.2-7.2,13.6-12.4,19.5c-5,5.2-5.6,11.8-5.3,18.5l-0.9,30.6l-3.1,21.1c-0.2,1-0.3,2-0.4,3c-0.4,3.2-0.6,6.5-0.2,9.8c5.4,4.9,11.4,9.5,15,16c1.2,2.5,2.1,5.2,2.9,7.9c-1.9-4.3-6.3-7.4-11.3-7.4c-6.8,0-12.4,5.5-12.4,12.4s5.5,12.4,12.4,12.4s12.4-5.5,12.4-12.4c0-0.7-0.1-1.3-0.2-1.9c1.5,5.4,2.9,10.9,5.2,16c0.7,1.4,1.5,2.5,2.5,3.6c1.8,2,4.1,3.5,6.6,4.7c4.1,2.1,8.7,3.5,12.6,5.4c11.2,4.1,17,15.4,26.2,22.3c8,1.9,16.5,0.3,24.7,0.4c16.2-2.1,32.4,13.1,47.9,2.8c13.2-8.9,28.1-13.5,43.8-15.2c8.9-8.2,17.3-17,27.2-24c0.5-0.4,1-0.7,1.6-1.1c2.4-3,4.2-6.4,5.5-9.9c0.5-1.4,1-2.9,1.4-4.4c2.7-7.2,7.2-13.7,12.4-19.6c5-5.2,5.6-11.8,5.3-18.5c-0.2-5.2-0.9-10.5-0.6-15.4c-0.3-5.2,0.5-10.2,1.5-15.2c-0.1-8.1,2.5-16,3.5-24.1c0.4-3.2,0.6-6.5,0.2-9.8c-5.4-4.9-11.4-9.5-15-16c-4-8.6-5-18.3-9.1-27c-0.7-1.3-1.5-2.5-2.5-3.6c-1.8-2-4.1-3.5-6.6-4.7c-3.6-1.8-7.6-3.2-11.3-4.8c0-0.2,0-0.3,0-0.5C295.9,109.3,296.7,96.3,295.7,83.5z M80.2,198.7c6.8,0,12.4-5.5,12.4-12.4c0-6.8-5.5-12.4-12.4-12.4c-6.8,0-12.4,5.5-12.4,12.4C67.8,193.2,73.3,198.7,80.2,198.7z M240.8,355.3c0-6.8-5.5-12.4-12.4-12.4c-6.8,0-12.4,5.5-12.4,12.4c0,6.8,5.5,12.4,12.4,12.4C235.2,367.7,240.8,362.2,240.8,355.3z M351.8,274.2c0-6.8-5.5-12.4-12.4-12.4c-6.8,0-12.4,5.5-12.4,12.4c0,6.8,5.5,12.4,12.4,12.4C346.3,286.6,351.8,281,351.8,274.2z M327,155c0,6.8,5.5,12.4,12.4,12.4c6.8,0,12.4-5.5,12.4-12.4c0-6.8-5.5-12.4-12.4-12.4C332.6,142.6,327,148.2,327,155z"/><path fill="#ED777A" d="M257.7,162.3c3.8,1.8,7.8,3.2,11.8,4.3c0,0.1-0.1,0.3-0.1,0.5c0,0.1,0,0.1,0,0.2c0,0.1-0.1,0.3-0.1,0.4c0,0.1-0.1,0.2-0.1,0.3c-4.5,4.1-10.6,7.2-13.4,12.8c1.6,10.8,6.5,20.7,11.3,30.3c0.1,0.5,0.3,1.5,0.4,2.2c0,0.2,0.1,0.5,0.1,0.6c-4.5-1.3-9-2.7-13.3-4.5c-4.3-1.8-8.4-4-12.2-6.8c-0.1-0.1-0.2-0.1-0.3-0.2c-0.1-0.1-0.3-0.2-0.4-0.3c-0.1-0.1-0.3-0.2-0.4-0.3c-0.1-0.1-0.2-0.2-0.3-0.2c-0.6-0.3-1.1-0.7-1.6-1.1c-3.2-2.2-6.2-4.7-8.8-7.5c-1.3-1.4-2.6-2.9-3.8-4.4c-1-1.2-1.9-2.5-2.8-3.8c-1.3-1.9-2.5-3.9-3.7-5.9c-5.8-12.1-8.7-25.2-10.7-38.4c0.6-0.2,1.2-0.5,1.8-0.7c1.6-0.7,3.3-1.4,4.9-2.2c2-1,3.9-2,5.8-3.2c0.6-0.4,1.1-0.7,1.7-1.1c0.2-0.1,0.4-0.3,0.7-0.4c0.1-0.1,0.3-0.2,0.4-0.3c0.1-0.1,0.2-0.2,0.4-0.2c0.1-0.1,0.2-0.1,0.2-0.2c0.1,0,0.1-0.1,0.2-0.1c1.7,3.2,3.6,6.2,5.8,9.1c2.5,3.3,5.4,6.4,8.5,9.2c2.2,2,4.6,3.9,7.1,5.6c0.5,0.3,1,0.7,1.5,1c1,0.7,2,1.3,3.1,1.9C253.4,160.2,255.5,161.3,257.7,162.3z M184.4,131.2c-1.2,1.7-2.4,3.4-3.7,5.1c-3.3,4.5-6.8,8.9-10.6,13c-0.9,1-1.9,2.1-2.8,3.1c-0.5,0.5-1,1-1.5,1.5c-1,1-2,2-3,3c-4.3,4.3-9.1,8.1-14.3,11.3c-2,1.2-4,2.4-5.9,3.6c5.1,2.9,10.2,5.8,15,9.3c3.1,6.6,0.1,14-1.5,20.6c-0.4,1.3-0.8,2.5-1.2,3.8c-0.4,1.3-0.8,2.5-1.2,3.8c-0.4,1.3-0.8,2.5-1.2,3.8c-0.4,1.3-0.7,2.5-1.1,3.8c0,0.7,0.1,2,0.1,2.7c3.5-1.6,6.9-3.4,10.1-5.6c1.1-0.7,2.1-1.4,3.2-2.2c1-0.8,2-1.5,3-2.4c0.5-0.4,1-0.8,1.5-1.2c1.7-1.5,3.3-3,4.9-4.6c0.9-0.9,1.8-1.9,2.7-2.9c0.6-0.6,1.1-1.3,1.7-1.9c0.1-0.2,0.3-0.3,0.4-0.5c0.5-0.6,1-1.2,1.5-1.9c1.1-1.5,2.2-3,3.3-4.5c0.8-1.2,1.6-2.5,2.4-3.7c0.5-0.8,0.9-1.5,1.4-2.3c0.3-0.6,0.6-1.1,0.9-1.7c0.5-0.8,0.9-1.7,1.3-2.5c0.4-0.9,0.9-1.7,1.3-2.6c0.5-1.2,1.1-2.3,1.5-3.5c3.3-7.5,5.8-15.4,7.2-23.4c0.3-1.5,0.5-2.9,0.7-4.4c0.3-2.2,0.5-4.4,0.7-6.7c-4.3-2.4-9-4.1-13-6.9C186.8,133.4,185.6,132.4,184.4,131.2z M222.8,123.5c0.1-0.3,0.3-0.7,0.4-1c0.1-0.2,0.1-0.3,0.2-0.5c0.1-0.3,0.3-0.6,0.3-0.8c0.2-0.5,0.4-0.9,0.6-1.4c0.2-0.5,0.4-0.9,0.6-1.4c0.4-1,0.7-1.9,0.9-2.9c0.3-1.2,0.6-2.5,0.7-3.8c0-0.3,0.1-0.5,0.1-0.8c0.1-1,0.2-2.1,0.2-3.1c0-0.5,0-1,0-1.6c-0.1-2.3-0.4-4.7-1-6.9c-0.4-1.8-1-3.5-1.8-5.1c-0.2-0.5-0.4-0.9-0.7-1.4c-0.1-0.2-0.2-0.5-0.4-0.7c-0.2-0.5-0.5-0.9-0.8-1.3c-0.3-0.4-0.5-0.9-0.8-1.3c-0.3-0.4-0.6-0.8-0.9-1.2c-2.9-3.8-6.8-6.9-11.7-8.5c-2.2-1-4.5-1.3-6.7-1.2c-0.4,0-0.8,0.1-1.2,0.1c-0.4,0-0.8,0.1-1.2,0.2c-0.4,0.1-0.8,0.2-1.2,0.3c-0.4,0.1-0.8,0.2-1.2,0.3c-0.2,0.1-0.4,0.1-0.6,0.2c-0.6,0.2-1.2,0.4-1.8,0.7c-0.4,0.2-0.8,0.3-1.2,0.5c-0.4,0.2-0.8,0.4-1.1,0.5c-0.4,0.2-0.7,0.4-1.1,0.6c-0.4,0.2-0.7,0.4-1.1,0.6c-0.2,0.1-0.4,0.2-0.5,0.3c-0.6,0.6-1.2,1.3-1.8,1.9c-0.8,1-1.6,2.1-2.3,3.1c-0.7,1.1-1.3,2.2-1.9,3.4c-0.7,1.5-1.3,3.1-1.8,4.8c-0.2,0.8-0.4,1.6-0.6,2.5c-0.2,0.8-0.3,1.7-0.4,2.5c-0.1,0.8-0.2,1.7-0.2,2.5c0,0.8,0,1.7,0,2.5c0,0.5,0,0.9,0.1,1.4c0.1,1.2,0.3,2.5,0.5,3.7c0.1,0.4,0.2,0.8,0.3,1.3c0.2,0.7,0.4,1.5,0.6,2.2c0.1,0.2,0.1,0.4,0.2,0.6c0.7,1.9,1.5,3.8,2.5,5.6c4.6,6.9,11.7,13.5,20.6,12.6c6.7,0.4,11.8-4.4,16.5-8.5C222.4,124.4,222.6,123.9,222.8,123.5z M154.2,132.4c1.3-0.2,2.6-0.4,3.9-0.6l22.1-7.2l-4.8-8.5c-3.1,0.5-6.3,0.2-9.5,0.1c-4.3-0.1-8.6-0.3-12.9-0.2c-1.8,0-3.6-1-3.8-2.9c-0.2-1.7,1.1-3.8,2.9-3.8c4.1-0.1,8.3,0.1,12.5,0.2c1.8,0,3.6,0,5.4,0.1c1.3,0,2.7,0.2,4,0c0-1.6,0-3.3,0-4.9c0-1.5,0-3.1,0-4.6c-0.5-0.1-1.1-0.3-1.6-0.7c-1.3-1.1-2.8-2-4.3-2.9c-3.6-1.5-7.3-2.9-10.8-4.6c-0.8-0.3-1.6-0.5-2.5-0.6c-4.4-0.3-3.4-7,0.9-6.8c1.8,0.1,3.5,0.7,5.2,1.4c1.7,0.7,3.5,1.3,5.2,2c3.3,1.3,6.5,3.1,9.4,5.2c0.9-2.6,1.8-5.2,2.3-7.9c-2-1.5-4.1-3-6.3-4.4c-4.4-2.6-9.1-4.8-13.9-6.5c-1.1-0.4-2.2-0.7-3.3-1c-1.1-0.3-2.2-0.6-3.3-0.9c-1.1-0.3-2.2-0.5-3.3-0.7c-0.6-0.1-1.1-0.2-1.7-0.3c-1.7-0.3-3.4-0.5-5.1-0.7c-1.1-0.1-2.3-0.2-3.4-0.3c-1.1-0.1-2.3-0.1-3.4-0.1c-2.3,0-4.6,0-6.8,0.2c-1.7,0.1-3.4,0.3-5.1,0.6c-1.1,0.2-2.3,0.3-3.4,0.6c-1.6,15.4-1.2,30.9,2,46.1c0.3,1.7,0.5,3.4,0.8,5.1c0.3,1.7,0.6,3.4,0.9,5.1c0,0.1,0.1,0.2,0.1,0.3c0.1,0.2,0.1,0.5,0.2,0.8c0,0.1,0.1,0.3,0.1,0.4c0.1,0.3,0.2,0.6,0.2,0.9c0.1,0.3,0.1,0.5,0.2,0.7c4.2,1.2,8.4,1.9,12.6,2.2c1.2,0.1,2.4,0.1,3.6,0.2c2.4,0.1,4.9,0,7.3-0.2C149.3,133,151.8,132.7,154.2,132.4z M282.9,62c-1.7,0-3.4,0-5.1,0.1c-2.3,0.1-4.5,0.4-6.8,0.7c-1.1,0.2-2.3,0.4-3.4,0.6c-1.1,0.2-2.2,0.5-3.3,0.7c-1.7,0.4-3.3,0.9-4.9,1.4c-0.5,0.2-1.1,0.4-1.6,0.5c-1.1,0.4-2.2,0.8-3.2,1.2c-1.1,0.4-2.1,0.9-3.2,1.3c-1,0.5-2.1,1-3.1,1.5c-4.6,2.3-8.9,5.1-13,8.2c-1.9,1.7-3.8,3.4-5.6,5.2c0.8,2.6,2,5.1,3.3,7.5c2.6-2.5,5.5-4.6,8.6-6.4c1.6-0.9,3.3-1.7,4.9-2.6c1.5-0.9,3.2-1.8,4.9-2.1c4.3-0.8,6.1,5.7,1.8,6.6c-0.9,0.2-1.7,0.5-2.4,0.9c-3.2,2.2-6.7,4.1-10.1,6c-1.4,1-2.7,2.2-3.9,3.4c-0.5,0.5-1,0.8-1.5,0.9c0.2,1.5,0.5,3,0.7,4.6c0.2,1.6,0.4,3.2,0.6,4.9c1.3,0.1,2.7-0.3,4-0.5c1.8-0.3,3.6-0.5,5.3-0.8c4.1-0.6,8.2-1.4,12.3-1.8c1.8-0.2,3.4,1.7,3.4,3.4c0,2-1.6,3.2-3.4,3.4c-4.3,0.5-8.5,1.3-12.8,1.9c-3.1,0.5-6.3,1.2-9.4,1.1l-4.3,10.6c1.2,0.2,2.4,0.4,3.6,0.6c1.2,0.2,2.4,0.4,3.6,0.5c4.8,0.7,9.8,1.2,14.7,1.5c1.8,0.1,3.7,0.2,5.5,0.2c2.5,0,4.9,0,7.3-0.2c2.4-0.2,4.9-0.4,7.3-0.8c1.2-0.2,2.4-0.4,3.6-0.7c4.2-0.9,8.3-2.1,12.2-3.9c0-0.2,0.1-0.5,0.1-0.7c0-0.3,0.1-0.6,0.1-0.9c0-0.2,0-0.3,0.1-0.5c0-0.3,0.1-0.6,0.1-0.8c0-0.1,0-0.2,0-0.3c0.1-1.7,0.2-3.4,0.3-5.2c0.1-1.7,0.1-3.4,0.1-5.2c1.2-15.4-0.4-30.9-4.1-45.9C285.1,62,284,62,282.9,62z M228.4,347.1c-4.5,0-8.2,3.7-8.2,8.2c0,4.5,3.7,8.2,8.2,8.2c4.5,0,8.2-3.7,8.2-8.2C236.6,350.8,232.9,347.1,228.4,347.1z M339.4,266c-4.5,0-8.2,3.7-8.2,8.2c0,4.5,3.7,8.2,8.2,8.2c4.5,0,8.2-3.7,8.2-8.2C347.6,269.7,344,266,339.4,266z M99.3,274.2c-4.5,0-8.2,3.7-8.2,8.2c0,4.5,3.7,8.2,8.2,8.2s8.2-3.7,8.2-8.2C107.5,277.9,103.9,274.2,99.3,274.2z M80.2,178.2c-4.5,0-8.2,3.7-8.2,8.2s3.7,8.2,8.2,8.2c4.5,0,8.2-3.7,8.2-8.2S84.7,178.2,80.2,178.2z M339.4,163.2c4.5,0,8.2-3.7,8.2-8.2s-3.7-8.2-8.2-8.2c-4.5,0-8.2,3.7-8.2,8.2S334.9,163.2,339.4,163.2z"/></g></svg>`;

        const giftBoxSVG = `<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 432 432" xml:space="preserve"><g><path fill="#23261F" d="M328.3,162.3v56.9h-14.4V374H118.1V219.2h-14.4v-56.9h56c-19-18.7-25.3-47.9-19.6-73.5c3.7-16,17.9-31.3,35.6-28.4c20.2,3.5,32.9,22.7,39.8,40.6c7.4-15,17-30,31.8-38.7c10-5.3,24.2-6.9,33,1.5c10.3,9.7,13.6,24.4,13.8,38.1c-0.8,20.6-7.4,40.8-18.8,58c-0.2,0.1-0.4,0.2-0.6,0.4c-0.6,0.7-1.3,1.3-1.9,1.9H328.3z"/><path fill="#F9F9FA" d="M178.9,115.5c-0.3-12.6,3.5-24.7,14.2-33c2.3,2.4,4.4,4.9,6.3,7.6c1.9,2.7,3.6,5.6,5,8.6c0.4,0.7,0.7,1.5,1,2.3c1.6,3.8,2.9,7.8,3.7,11.8c0.3,1.6,0.6,3.2,0.7,4.9c-2.8,14.9-5.5,30.3-1.8,45.2h-10.5c-4.4-4-7.5-10.3-10.3-15.3c-0.9-1.9-1.8-3.9-2.6-5.9c-0.5-1.4-1.1-2.7-1.5-4.1c-0.5-1.4-0.9-2.8-1.3-4.3c-0.2-0.7-0.4-1.4-0.6-2.2c-0.4-1.5-0.7-2.9-1-4.4C179.4,122.9,179,119.2,178.9,115.5z M222.7,162.8c0-0.1,0.1-0.1,0.1-0.2c2-3.2,3.8-6.5,5.4-9.9c0.8-1.7,1.6-3.4,2.3-5.1c2.9-6.9,5-14.1,6.4-21.5c2.9-14.7,3.2-30,1.4-44.9c-16.5,17.6-25.3,41.9-25.7,65.9c0.5,5,0.3,11.1,2.7,15.7H222.7z"/><path fill="#ADBB8D" d="M144.7,112.8c0-1.3-0.1-2.6,0-3.9c0-1.3,0.1-2.6,0.2-3.9c0.1-0.9,0.2-1.7,0.3-2.6c0.1-0.9,0.2-1.7,0.4-2.6c0.2-1.3,0.5-2.6,0.8-3.8c0.2-0.8,0.4-1.7,0.7-2.5c1.8-6.2,4.9-12,9.6-16.8c8.2-9,24.3-7.4,31.8,1.5c-2.7,2-5.1,4.3-7.1,6.8c-0.7,0.8-1.3,1.7-1.9,2.6c-1.8,2.7-3.2,5.6-4.3,8.6c-0.9,2.5-1.6,5.1-2.1,7.8c-0.1,0.5-0.2,1.1-0.3,1.6c-0.2,1.1-0.3,2.2-0.4,3.2c-0.3,3.3-0.3,6.5-0.1,9.8c0.1,1.1,0.2,2.2,0.3,3.2c0.1,1.1,0.3,2.1,0.5,3.2c1.7,13.8,7.8,26.4,15.4,37.8H165c-7.8-8.4-13.4-18.8-16.7-29.9c-0.7-2.3-1.3-4.6-1.8-7c-0.3-1.2-0.5-2.4-0.7-3.5c-0.4-2.4-0.7-4.7-0.9-7.1C144.8,114.5,144.8,113.6,144.7,112.8z M266.8,162.8c1.5-2.2,3-4.4,4.4-6.7c0.7-1.2,1.4-2.4,2.1-3.6c0.7-1.2,1.3-2.4,1.9-3.7c1.2-2.5,2.4-5,3.5-7.6c0.5-1.3,1-2.6,1.5-3.9c0.5-1.3,0.9-2.6,1.4-3.9c1.9-5.9,3.3-12,4.1-18.2c0.2-1.4,0.3-2.7,0.5-4.1c0.2-2.8,0.4-5.5,0.4-8.3c-0.2-2.3-0.4-4.6-0.8-7c-0.2-1.2-0.4-2.4-0.6-3.6c-0.1-0.4-0.2-0.8-0.3-1.2c-0.4-1.6-0.8-3.1-1.3-4.6c-0.3-0.8-0.5-1.5-0.8-2.3c-1.3-3.3-3.1-6.4-5.4-9c-0.3-0.3-0.5-0.6-0.8-0.8c-0.5-0.6-1.1-1.1-1.7-1.6c-0.3-0.2-0.6-0.5-0.9-0.7c-1-0.7-2-1.3-3.1-1.9c-2.4-1.2-4.8-1.7-7.3-1.8c-0.6,0-1.2,0-1.8,0c-2.1,0.2-4.2,0.6-6.3,1.4c-1.5,0.5-2.9,1.1-4.3,1.8c-2,1-3.9,2.1-5.7,3.3c-0.5,0.3-1,0.7-1.5,1c-0.3,0.2-0.5,0.3-0.8,0.5c0.2,0.9,0.5,1.9,0.7,2.8c0.6,2.8,1.1,5.7,1.5,8.6c0.3,1.9,0.5,3.8,0.6,5.7c0.2,2.9,0.4,5.8,0.4,8.6c0.1,7.7-0.6,15.4-2,22.9c-0.7,3.8-1.5,7.5-2.6,11.3c-1.5,5.6-3.4,11.1-5.7,16.4c-0.4,0.9-0.8,1.8-1.1,2.7c-0.8,1.8-1.6,3.5-2.5,5.2c-0.3,0.7-0.7,1.3-1,2H266.8z M175.3,213.4h81.4v-0.3h6.4v-44.7h-94.2v44.7h6.4V213.4z M190.1,218.9v149h51.9v-149H190.1z"/><path fill="#EE7879" d="M273.2,213.1h-3.5v-44.7h51.5v44.7h-3.5v0.3h-44.5V213.1z M114.3,213.4h44.5v-0.3h3.5v-44.7h-51.5v44.7h3.5V213.4z M247.6,218.9v149h59.4v-149H247.6z M124.9,218.9v149h59.4v-149H124.9z"/></g></svg>`;

        const faviconTokiSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 289.15 263.02"><defs><style>.cls-1{fill:none;stroke:#303030;stroke-linecap:round;stroke-linejoin:round;stroke-width:26.31px;}.cls-2{fill:#303030;}.cls-3{fill:#00d0be;}</style></defs><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path class="cls-1" d="M249.87,131.51a118.29,118.29,0,1,1-72.29-109"/><path class="cls-2" d="M256.87,130l4.32,0a28.12,28.12,0,0,0,28-28.26l-.22-40.77L277.57,61l-.19-36.53a6.09,6.09,0,1,0-12.18.07l.2,36.53L236,61.22l-.2-36.53a6.09,6.09,0,1,0-12.17.07l.19,36.53-11.36.06.22,40.77a28.09,28.09,0,0,0,28.25,27.95l3.83,0"/><circle class="cls-3" cx="82" cy="133.01" r="19.55"/><circle class="cls-3" cx="183.14" cy="133.01" r="19.55"/><circle class="cls-3" cx="132.57" cy="133.01" r="19.55"/></g></g></svg>`;

        return `
      <div class="postcard-page">
        <div class="postcard-container">
          <div class="postcard-inner">
            <div class="decoration decoration-top-left">
              ${christmasWreathSVG}
            </div>

            <div class="decoration decoration-top-right">
              ${faviconTokiSVG}
            </div>

            <h1 class="postcard-title">
              Your Secret Santa Assignment
            </h1>
            <p class="postcard-welcome">
              Welcome, <span class="font-semibold">${escapeHtml(giver)}</span>! You have been picked to get a gift for:
            </p>
            <div class="postcard-receiver">
              ${escapeHtml(receiver)}
            </div>
            ${instructionsHTML}

            <div class="decoration decoration-bottom-left">
              ${faviconTokiSVG}
            </div>

            <div class="decoration decoration-bottom-right">
              ${giftBoxSVG}
            </div>
          </div>
        </div>
      </div>
    `;
    }).join('');

    return `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Secret Santa PostCards</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Comic Sans MS', cursive;
      background: #fefae8;
    }
    
    .postcard-page {
      width: 100%;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      page-break-after: always;
      page-break-inside: avoid;
    }
    
    .postcard-page:last-child {
      page-break-after: auto;
    }
    
    .postcard-container {
      max-width: 600px;
      width: 100%;
      margin: 0 auto;
      padding: 12px;
      background: repeating-linear-gradient(
        45deg,
        #5CC48A,
        #5CC48A 30px,
        #FFFFFF 30px,
        #FFFFFF 60px,
        #EF3D3D 60px,
        #EF3D3D 90px,
        #FFFFFF 90px,
        #FFFFFF 120px
      );
      transform: rotate(2deg);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }
    
    .postcard-inner {
      position: relative;
      padding: 32px;
      background: white;
      border-radius: 4px;
    }
    
    .decoration {
      position: absolute;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      overflow: hidden;
    }
    
    .decoration svg {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .decoration-top-left {
      top: -24px;
      left: -24px;
      background: #5CC48A;
      transform: rotate(-12deg);
    }
    
    .decoration-top-right {
      top: -24px;
      right: -24px;
      background: #FFFFFF;
      transform: rotate(12deg);
      width: 48px;
      height: 48px;
    }
    
    .decoration-top-right svg {
      width: 75%;
      height: 75%;
    }
    
    .decoration-bottom-left {
      bottom: -24px;
      left: -24px;
      background: #FFFFFF;
      transform: rotate(-12deg);
      width: 48px;
      height: 48px;
    }
    
    .decoration-bottom-left svg {
      width: 75%;
      height: 75%;
    }
    
    .decoration-bottom-right {
      bottom: -24px;
      right: -24px;
      background: #EF3D3D;
      transform: rotate(12deg);
    }
    
    .postcard-title {
      font-size: 1.875rem;
      font-weight: bold;
      margin-bottom: 1.5rem;
      text-align: center;
      color: #b91c1c;
    }
    
    .postcard-welcome {
      margin-bottom: 1.5rem;
      text-align: center;
      color: #4b5563;
    }
    
    .postcard-welcome .font-semibold {
      font-weight: 600;
    }
    
    .postcard-receiver {
      font-size: 5rem;
      font-weight: bold;
      text-align: center;
      padding: 1.5rem;
      font-family: 'Dancing Script', cursive;
    }
    
    .font-dancing-script {
      font-family: 'Dancing Script', cursive;
    }
    
    @media print {
      body {
        background: white;
      }
      
      .postcard-page {
        page-break-after: always;
        page-break-inside: avoid;
        margin: 0;
        padding: 20px;
      }
      
      .postcard-page:last-child {
        page-break-after: auto;
      }
      
      @page {
        size: A4;
        margin: 1cm;
      }
    }
  </style>
</head>
<body>
  ${postCardsHTML}
</body>
</html>`;
}

function escapeHtml(text: string): string {
    const map: Record<string, string> = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;',
    };
    return text.replace(/[&<>"']/g, (m) => map[m]);
}

